<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Score | سكور - المنصة الأولى للتوظيف والسير الذاتية</title>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&family=Noto+Naskh+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Cairo', 'sans-serif'],
              serif: ['Noto Naskh Arabic', 'serif'], // Better for detailed reading
            },
            colors: {
              dark: '#050505',
              card: '#121212',
              primary: '#7C3AED', 
              'primary-light': '#A78BFA',
              'primary-dark': '#5B21B6',
              secondary: '#E5E7EB',
              gold: '#F59E0B',
              'gold-light': '#FCD34D',
            },
            animation: {
              'fade-up': 'fadeUp 0.8s ease-out forwards',
              'fade-in': 'fadeIn 0.5s ease-out forwards',
              'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
              'shimmer': 'shimmer 2s linear infinite',
            },
            keyframes: {
              fadeUp: {
                '0%': { opacity: '0', transform: 'translateY(20px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' },
              },
              fadeIn: {
                '0%': { opacity: '0' },
                '100%': { opacity: '1' },
              },
              shimmer: {
                '0%': { backgroundPosition: '-1000px 0' },
                '100%': { backgroundPosition: '1000px 0' }
              }
            }
          }
        }
      }
    </script>
    <style>
      body {
        font-family: 'Cairo', sans-serif;
        background-color: #050505;
        color: #E5E7EB;
        overflow-x: hidden;
      }
      
      /* Premium Scrollbar */
      ::-webkit-scrollbar { width: 6px; }
      ::-webkit-scrollbar-track { background: #0A0A0A; }
      ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
      ::-webkit-scrollbar-thumb:hover { background: #7C3AED; }
      
      /* View Routing */
      .view-section {
        display: none;
        opacity: 0;
        animation: fadeIn 0.4s ease-out forwards;
      }
      .view-section.active {
        display: block;
        opacity: 1;
      }

      /* Loader */
      .loader {
        border: 3px solid rgba(255,255,255,0.1);
        border-radius: 50%;
        border-top: 3px solid #7C3AED;
        width: 24px;
        height: 24px;
        -webkit-animation: spin 1s linear infinite; /* Safari */
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* Screen Preview Styles */
      .cv-paper {
        background: white;
        width: 210mm;
        min-height: 297mm;
        box-shadow: 0 0 40px rgba(0,0,0,0.5);
        color: black;
        overflow: hidden;
        position: relative;
        transform-origin: top center;
        margin: 0 auto;
        padding: 0;
      }
      
      /* PRINT STYLES - Solves Arabic Font Issues */
      @media print {
        @page { margin: 0; size: auto; }
        body { background: white; color: black; }
        
        /* Hide everything except the CV */
        header, .view-section, #mobile-menu, #offer-modal, #ats-modal, #ai-loading, .no-print, #preview-actions {
            display: none !important;
        }
        
        /* Show only the Final CV container */
        #view-final { display: block !important; position: static !important; height: auto !important; overflow: visible !important; background: white !important; }
        #cv-final-wrapper { 
            transform: none !important; 
            box-shadow: none !important; 
            margin: 0 !important; 
            width: 100% !important;
            height: auto !important;
            padding: 0 !important;
        }
        .cv-paper {
            box-shadow: none !important;
            margin: 0 !important;
            width: 100% !important;
            page-break-after: auto;
        }
      }
      
      /* Glass Utility */
      .glass-panel {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      
      /* Table Styles */
      .admin-table th { text-align: right; padding: 1rem; color: #9CA3AF; font-size: 0.875rem; border-bottom: 1px solid rgba(255,255,255,0.1); white-space: nowrap; }
      .admin-table td { padding: 1rem; border-bottom: 1px solid rgba(255,255,255,0.05); white-space: nowrap; }
      .admin-table tr:hover td { background-color: rgba(255,255,255,0.02); }
    </style>
  <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.33.0",
    "react": "https://esm.sh/react@^19.2.3",
    "react-router-dom": "https://esm.sh/react-router-dom@^7.10.1",
    "lucide-react": "https://esm.sh/lucide-react@^0.561.0",
    "react/": "https://esm.sh/react@^19.2.3/",
    "framer-motion": "https://esm.sh/framer-motion@^12.23.26",
    "axios": "https://esm.sh/axios@^1.13.2"
  }
}
</script>
</head>
  <body class="bg-dark text-secondary selection:bg-primary selection:text-white flex flex-col min-h-screen">

    <!-- HEADER -->
    <header class="sticky top-0 z-50 bg-dark/80 backdrop-blur-xl border-b border-white/5 no-print">
        <div class="container mx-auto px-4 h-20 flex items-center justify-between">
          
          <!-- Logo -->
          <a href="#" onclick="app.navigate('home'); return false;" class="flex items-center gap-3 group">
            <div class="relative w-10 h-10 flex items-center justify-center bg-gradient-to-br from-primary to-indigo-600 rounded-xl shadow-lg shadow-primary/20 group-hover:rotate-12 transition-transform">
              <i data-lucide="star" class="w-6 h-6 text-white fill-white"></i>
            </div>
            <div class="flex flex-col">
              <span class="text-2xl font-black text-white tracking-tight">سكور</span>
              <span class="text-[10px] text-primary-light font-bold uppercase tracking-[0.2em] -mt-1">Score CV</span>
            </div>
          </a>

          <!-- Desktop Nav -->
          <nav class="hidden md:flex items-center gap-1 bg-white/5 p-1 rounded-full border border-white/5">
            <a href="#" onclick="app.navigate('home'); return false;" class="nav-link px-5 py-2 rounded-full text-sm font-bold text-white bg-white/10 transition-all" data-target="home">الرئيسية</a>
            <a href="#" onclick="app.navigate('templates'); return false;" class="nav-link px-5 py-2 rounded-full text-sm font-medium text-gray-400 hover:text-white transition-all" data-target="templates">القوالب</a>
            <a href="#" onclick="app.navigate('ai-start'); return false;" class="nav-link px-5 py-2 rounded-full text-sm font-medium text-purple-400 hover:text-purple-300 transition-all flex items-center gap-2" data-target="ai-start">
                <i data-lucide="sparkles" class="w-4 h-4"></i>
                صانع السيرة
            </a>
            <a href="#" onclick="app.navigate('job-guarantee'); return false;" class="nav-link px-5 py-2 rounded-full text-sm font-medium text-amber-400 hover:text-amber-300 transition-all flex items-center gap-2" data-target="job-guarantee">
                <i data-lucide="crown" class="w-4 h-4"></i>
                التوظيف المضمون
            </a>
          </nav>

          <!-- Actions -->
          <div class="hidden md:flex items-center gap-4">
             <button id="header-auth-btn" onclick="app.navigate('auth')" class="text-sm font-medium text-gray-400 hover:text-white transition-colors">
                 تسجيل الدخول
             </button>
             <button onclick="app.navigate('ai-start')" class="relative group bg-white text-dark px-6 py-2.5 rounded-xl font-bold hover:bg-gray-100 transition-all active:scale-95 flex items-center gap-2 shadow-[0_0_20px_rgba(255,255,255,0.1)]">
                 <span>اصنع سيرتك بالذكاء</span>
                 <i data-lucide="bot" class="w-4 h-4 text-primary group-hover:rotate-12 transition-transform"></i>
             </button>
          </div>

          <!-- Mobile Toggle -->
          <button onclick="app.toggleMenu()" class="md:hidden p-3 bg-white/5 rounded-xl text-white">
            <i data-lucide="menu" class="w-6 h-6"></i>
          </button>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden fixed inset-0 z-50 bg-dark/95 backdrop-blur-xl pt-24 px-6 space-y-4 md:hidden animate-fade-in">
             <button onclick="app.toggleMenu()" class="absolute top-6 right-6 p-2 bg-white/10 rounded-full text-white"><i data-lucide="x"></i></button>
             <a href="#" onclick="app.navigate('home'); app.toggleMenu()" class="block text-2xl font-bold text-white py-4 border-b border-white/10">الرئيسية</a>
             <a href="#" onclick="app.navigate('ai-start'); app.toggleMenu()" class="block text-2xl font-bold text-purple-400 py-4 border-b border-white/10">بناء بالذكاء الاصطناعي ✨</a>
             <a href="#" onclick="app.navigate('templates'); app.toggleMenu()" class="block text-2xl font-bold text-white py-4 border-b border-white/10">قوالب السيرة</a>
             <a href="#" onclick="app.navigate('job-guarantee'); app.toggleMenu()" class="block text-2xl font-bold text-amber-400 py-4 border-b border-white/10">خدمة التوظيف <span class="text-xs bg-amber-500/20 px-2 py-1 rounded-full">Pro</span></a>
             <a href="#" onclick="app.navigate('dashboard'); app.toggleMenu()" class="block text-2xl font-bold text-white py-4 border-b border-white/10">لوحة التحكم</a>
             <button onclick="app.navigate('ai-start'); app.toggleMenu()" class="w-full mt-8 bg-primary text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-primary/40">ابدأ الآن</button>
        </div>
    </header>

    <!-- APP CONTENT -->
    <main id="app-container" class="flex-grow relative z-10 overflow-hidden">
        
        <!-- PAGE: HOME -->
        <section id="view-home" class="view-section active">
            <!-- Hero -->
            <div class="relative pt-20 pb-32 lg:pt-32 overflow-hidden">
                <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-full max-w-7xl pointer-events-none">
                   <div class="absolute top-0 left-1/4 w-[500px] h-[500px] bg-primary/20 rounded-full blur-[120px] animate-pulse-slow"></div>
                   <div class="absolute bottom-0 right-1/4 w-[500px] h-[500px] bg-blue-600/10 rounded-full blur-[120px]"></div>
                </div>

                <div class="container mx-auto px-4 relative z-10 text-center">
                    <div class="inline-flex items-center gap-2 bg-white/5 border border-white/10 backdrop-blur-md text-gray-300 px-4 py-1.5 rounded-full text-sm font-medium mb-8 shadow-2xl">
                      <span class="flex h-2 w-2 relative">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                      </span>
                      مدعوم بأحدث تقنيات Gemini AI 2.5
                    </div>
                    
                    <h1 class="text-5xl md:text-7xl font-black text-white leading-tight mb-8 max-w-5xl mx-auto tracking-tight">
                      سيرتك الذاتية.. <br/>
                      <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-indigo-400">بوابتك للشركات العالمية</span>
                    </h1>
                    
                    <p class="text-xl text-gray-400 mb-12 max-w-2xl mx-auto leading-relaxed">
                      أنشئ سيرة ذاتية تتجاوز أنظمة الفرز (ATS) بذكاء اصطناعي دقيق. 
                      نحن نرتب خبراتك، ولا نؤلفها.
                    </p>
                    
                    <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
                      <button onclick="app.navigate('ai-start')" class="w-full sm:w-auto px-10 py-5 bg-gradient-to-r from-primary to-indigo-600 text-white text-lg font-bold rounded-2xl shadow-[0_0_40px_rgba(124,58,237,0.3)] hover:scale-105 transition-all active:scale-95 flex items-center justify-center gap-2">
                        <i data-lucide="sparkles" class="w-5 h-5 text-white"></i>
                        صمم لي بالذكاء الاصطناعي
                      </button>
                      <button onclick="app.navigate('templates')" class="w-full sm:w-auto px-10 py-5 bg-white/5 text-white border border-white/10 text-lg font-bold rounded-2xl hover:bg-white/10 transition-all flex items-center justify-center gap-2">
                           <i data-lucide="layout" class="w-5 h-5 text-gray-300"></i>
                           تصفح القوالب
                      </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- PAGE: AI START -->
        <section id="view-ai-start" class="view-section">
            <div class="min-h-screen relative flex items-center justify-center overflow-hidden py-20">
                <div class="container mx-auto px-4 relative z-10 max-w-3xl">
                    <div class="bg-card/80 backdrop-blur-xl border border-white/10 rounded-3xl p-8 md:p-12 shadow-2xl">
                        <div class="text-center mb-8">
                            <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-primary to-indigo-600 text-white mb-6 shadow-lg shadow-primary/30">
                                <i data-lucide="brain-circuit" class="w-8 h-8"></i>
                            </div>
                            <h1 class="text-3xl md:text-4xl font-black text-white mb-3">المنظم الذكي للسير الذاتية</h1>
                            <p class="text-gray-400 text-lg">
                                <span class="text-primary font-bold">انسخ وألصق كل بياناتك هنا</span> (اسمك، رقمك، خبراتك، تعليمك) بشكل عشوائي، وسنقوم بترتيبه لك في سيرة ذاتية احترافية فوراً.
                            </p>
                        </div>

                        <div class="space-y-6">
                            <div>
                                <label class="block text-white font-bold mb-2 flex items-center gap-2">
                                    <i data-lucide="file-text" class="w-4 h-4 text-primary"></i>
                                    الصق بياناتك هنا
                                </label>
                                <textarea id="ai-blob-input" rows="8" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-white focus:border-primary outline-none transition-all placeholder-gray-600 leading-relaxed" placeholder="مثال:
أنا محمد خالد، رقم جوالي 0555555555
خريج جامعة الملك سعود إدارة أعمال 2020
اشتغلت في شركة زين كخدمة عملاء من 2021 الى 2022
وبعدها في الراجحي صراف أول الى الان
مهاراتي: اكسل، تواصل، لغة انجليزية جيدة..."></textarea>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-white font-bold mb-2">لغة السيرة الذاتية</label>
                                    <div class="flex bg-white/5 p-1 rounded-xl">
                                        <button onclick="app.ai.setLang('ar')" id="btn-lang-ar" class="flex-1 py-2 rounded-lg text-sm font-bold bg-primary text-white transition-all">العربية</button>
                                        <button onclick="app.ai.setLang('en')" id="btn-lang-en" class="flex-1 py-2 rounded-lg text-sm font-bold text-gray-400 hover:text-white transition-all">English</button>
                                    </div>
                                </div>
                                <div class="flex items-end">
                                     <div class="bg-yellow-500/10 border border-yellow-500/20 text-yellow-200 text-xs p-3 rounded-xl w-full">
                                         <i data-lucide="alert-circle" class="inline w-3 h-3 mb-1"></i>
                                         الذكاء الاصطناعي <strong>لن يؤلف</strong> معلومات غير موجودة. تأكد من كتابة كل التفاصيل.
                                     </div>
                                </div>
                            </div>

                            <button onclick="app.ai.generate()" class="w-full py-4 bg-gradient-to-r from-primary to-indigo-600 hover:from-primary-light hover:to-primary text-white font-bold text-lg rounded-xl shadow-lg shadow-primary/30 transform hover:scale-[1.02] transition-all flex items-center justify-center gap-2">
                                <i data-lucide="wand-2" class="w-5 h-5"></i> تحليل وإنشاء السيرة (إنهاء)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- PAGE: TEMPLATES -->
        <section id="view-templates" class="view-section">
            <div class="container mx-auto px-4 py-20">
                <div class="text-center mb-16">
                    <h1 class="text-4xl font-black text-white mb-4">قوالب ATS المعتمدة</h1>
                    <p class="text-gray-400 text-lg">تصاميم نظيفة وواضحة تضمن مرور سيرتك من أنظمة الفرز الآلي</p>
                </div>
                <div class="columns-1 md:columns-2 lg:columns-3 gap-8" id="templates-grid">
                    <!-- Dynamic Templates -->
                </div>
            </div>
        </section>

        <!-- PAGE: BUILDER (Manual) -->
        <section id="view-builder" class="view-section">
            <div class="min-h-screen bg-[#0A0A0A] flex flex-col md:flex-row relative">
                <!-- Sidebar Form -->
                <div class="w-full md:w-[45%] lg:w-[40%] bg-dark border-l border-white/5 flex flex-col h-screen overflow-hidden no-print">
                    <div class="p-6 border-b border-white/5 flex flex-col gap-4 bg-dark z-20">
                        <div class="flex justify-between items-center">
                            <h2 class="font-bold text-white flex items-center gap-2"><i data-lucide="edit-3" class="w-4 h-4 text-primary"></i> المحرر</h2>
                            <button onclick="app.navigate('final')" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-bold text-sm shadow-lg shadow-green-900/20 transition-all flex items-center gap-2">
                                <i data-lucide="check-circle" class="w-4 h-4"></i> إنهاء ومعاينة
                            </button>
                        </div>
                    </div>

                    <!-- Steps Navigation -->
                    <div class="flex overflow-x-auto p-4 gap-2 border-b border-white/5 no-scrollbar">
                        <button onclick="app.builder.setStep(0)" id="step-btn-0" class="step-btn active whitespace-nowrap px-4 py-2 rounded-lg text-sm font-bold transition-all">البيانات</button>
                        <button onclick="app.builder.setStep(1)" id="step-btn-1" class="step-btn whitespace-nowrap px-4 py-2 rounded-lg text-sm font-bold transition-all">الخبرات</button>
                        <button onclick="app.builder.setStep(2)" id="step-btn-2" class="step-btn whitespace-nowrap px-4 py-2 rounded-lg text-sm font-bold transition-all">التعليم</button>
                        <button onclick="app.builder.setStep(3)" id="step-btn-3" class="step-btn whitespace-nowrap px-4 py-2 rounded-lg text-sm font-bold transition-all">المهارات</button>
                    </div>

                    <!-- Form Content -->
                    <div class="flex-grow overflow-y-auto p-6 space-y-6 custom-scrollbar pb-32 md:pb-24">
                        <!-- Step 0: Personal Info -->
                        <div id="step-content-0" class="step-content">
                            <div class="space-y-4">
                                <div><label class="block text-xs font-bold text-gray-500 mb-2">الاسم الكامل</label><input type="text" id="inp-name" oninput="app.builder.updatePreview()" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none" placeholder="الاسم"></div>
                                <div><label class="block text-xs font-bold text-gray-500 mb-2">المسمى الوظيفي</label><input type="text" id="inp-title" oninput="app.builder.updatePreview()" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none" placeholder="مثال: مدير مشاريع"></div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div><label class="block text-xs font-bold text-gray-500 mb-2">الإيميل</label><input type="email" id="inp-email" oninput="app.builder.updatePreview()" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none text-left" dir="ltr" placeholder="Email"></div>
                                    <div><label class="block text-xs font-bold text-gray-500 mb-2">الجوال</label><input type="text" id="inp-phone" oninput="app.builder.updatePreview()" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none text-left" dir="ltr" placeholder="Phone"></div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-2"><label class="block text-xs font-bold text-gray-500">الملخص المهني</label></div>
                                    <textarea id="inp-summary" oninput="app.builder.updatePreview()" rows="6" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none leading-relaxed text-sm" placeholder="اكتب نبذة مختصرة..."></textarea>
                                </div>
                            </div>
                        </div>
                        <!-- Other steps same as before... (omitted for brevity, assume content exists) -->
                        <div id="step-content-1" class="step-content hidden">
                            <!-- Experience Inputs -->
                            <div class="bg-white/5 border border-white/5 rounded-xl p-4 mb-4">
                                <h4 class="font-bold text-white mb-2">الخبرة الأخيرة</h4>
                                <input type="text" id="inp-exp-role" oninput="app.builder.updatePreview()" class="w-full bg-dark border border-white/10 rounded-lg p-3 text-sm text-white mb-2" placeholder="المسمى الوظيفي">
                                <input type="text" id="inp-exp-comp" oninput="app.builder.updatePreview()" class="w-full bg-dark border border-white/10 rounded-lg p-3 text-sm text-white mb-2" placeholder="الشركة">
                                <input type="text" id="inp-exp-date" oninput="app.builder.updatePreview()" class="w-full bg-dark border border-white/10 rounded-lg p-3 text-sm text-white mb-2" placeholder="الفترة (مثال: 2020 - الآن)">
                                <textarea id="inp-exp-desc" oninput="app.builder.updatePreview()" rows="6" class="w-full bg-dark border border-white/10 rounded-lg p-3 text-sm text-white leading-relaxed" placeholder="الوصف والمهام..."></textarea>
                            </div>
                        </div>
                        <div id="step-content-2" class="step-content hidden">
                            <!-- Education Inputs -->
                            <div class="bg-white/5 border border-white/5 rounded-xl p-4 mb-4">
                                <input type="text" id="inp-edu-deg" oninput="app.builder.updatePreview()" class="w-full bg-dark border border-white/10 rounded-lg p-3 text-sm text-white mb-2" placeholder="الدرجة العلمية">
                                <input type="text" id="inp-edu-uni" oninput="app.builder.updatePreview()" class="w-full bg-dark border border-white/10 rounded-lg p-3 text-sm text-white mb-2" placeholder="الجامعة">
                                <input type="text" id="inp-edu-year" oninput="app.builder.updatePreview()" class="w-full bg-dark border border-white/10 rounded-lg p-3 text-sm text-white" placeholder="سنة التخرج">
                            </div>
                        </div>
                        <div id="step-content-3" class="step-content hidden">
                            <!-- Skills Inputs -->
                            <label class="block text-xs font-bold text-gray-500 mb-2">المهارات (افصل بفاصلة)</label>
                            <textarea id="inp-skills" oninput="app.builder.updatePreview()" rows="6" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none" placeholder="قيادة، إدارة وقت، Excel..."></textarea>
                            
                            <button onclick="app.navigate('final')" class="w-full mt-8 py-4 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 animate-pulse">
                               <i data-lucide="check-circle" class="w-5 h-5"></i> الانتهاء وعرض الشكل النهائي
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Live Preview Pane (Hidden on mobile) -->
                <div class="hidden md:flex flex-col flex-grow bg-[#525659] items-center justify-center p-8">
                    <div class="transform scale-[0.65] lg:scale-[0.75] origin-center shadow-2xl">
                        <div id="cv-preview" class="cv-paper"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- PAGE: FINAL VIEW (For AI & Finished Manual) -->
        <section id="view-final" class="view-section">
            <div class="min-h-screen bg-[#525659] flex flex-col items-center py-8">
                <!-- Toolbar -->
                <div id="preview-actions" class="sticky top-6 z-50 flex gap-4 bg-dark/90 backdrop-blur-md p-2 rounded-2xl border border-white/10 shadow-2xl mb-8 animate-fade-in no-print">
                    <button onclick="app.navigate('builder')" class="text-white hover:bg-white/10 px-4 py-2 rounded-xl flex items-center gap-2 text-sm font-bold transition-all">
                        <i data-lucide="edit-3" class="w-4 h-4"></i> تعديل
                    </button>
                    <div class="w-px bg-white/20 my-1"></div>
                    <button onclick="window.print()" class="bg-primary hover:bg-primary-dark text-white px-6 py-2 rounded-xl font-bold shadow-lg shadow-primary/20 transition-all flex items-center gap-2">
                        <i data-lucide="printer" class="w-4 h-4"></i> طباعة / تحميل PDF
                    </button>
                </div>

                <!-- Final Paper Container -->
                <div id="cv-final-wrapper" class="origin-top shadow-[0_0_50px_rgba(0,0,0,0.5)] animate-fade-up">
                    <div id="cv-final-render" class="cv-paper">
                         <!-- Content injected via JS -->
                    </div>
                </div>
            </div>
        </section>

        <!-- ADMIN & OTHER SECTIONS OMITTED FOR BREVITY (Keep them as is) -->
        <section id="view-admin" class="view-section">
            <!-- (Same Admin content as before) -->
             <div class="min-h-screen bg-[#050505] flex flex-col md:flex-row">
                <div class="w-full md:w-64 bg-card border-b md:border-b-0 md:border-l border-white/5 flex-shrink-0 flex md:flex-col justify-between md:justify-start">
                    <div class="p-4 md:p-6 border-b border-white/5 hidden md:block">
                        <h2 class="text-xl font-bold text-white flex items-center gap-2"><i data-lucide="shield" class="text-primary"></i> Admin</h2>
                    </div>
                    <nav class="p-4 flex md:flex-col gap-2 overflow-x-auto md:overflow-visible">
                        <button class="flex-shrink-0 md:w-full text-right p-3 rounded-xl bg-white/5 text-white font-bold flex items-center gap-3"><i data-lucide="users" class="w-5"></i> المشتركين</button>
                    </nav>
                </div>
                <div class="flex-1 p-8 text-white text-center pt-20">لوحة التحكم (Admin)</div>
            </div>
        </section>
        
        <section id="view-auth" class="view-section"><div class="min-h-screen bg-dark flex items-center justify-center text-white">تسجيل الدخول</div></section>
        <section id="view-job-guarantee" class="view-section"><div class="min-h-screen bg-dark flex items-center justify-center text-white">التوظيف المضمون</div></section>
        <section id="view-jobs-tracking" class="view-section"><div class="min-h-screen bg-dark flex items-center justify-center text-white">تتبع التوظيف</div></section>

    </main>

    <!-- MODALS (Offer, ATS, Loading) - Keep as is -->
    <div id="ai-loading" class="hidden fixed inset-0 z-[60] bg-black/90 flex items-center justify-center no-print">
         <div class="text-center">
             <div class="loader mx-auto mb-4"></div>
             <h2 id="ai-loading-text" class="text-xl font-bold text-white animate-pulse">الذكاء الاصطناعي يرتب سيرتك...</h2>
         </div>
    </div>

    <!-- Logic -->
    <script type="module">
      import { GoogleGenAI } from "@google/genai";

      // Mock Database
      const db = {
          users: [] // ... existing mock data
      };

      window.app = {
        state: {
            lang: 'ar',
            currentUser: null,
            template: 'classic',
            data: {
                name: "", title: "", email: "", phone: "", summary: "",
                exp: { role: "", comp: "", date: "", desc: "" },
                edu: { deg: "", uni: "", year: "" },
                skills: ""
            }
        },

        navigate: function(pageId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            const target = document.getElementById('view-' + pageId);
            if (target) {
                target.classList.add('active');
                window.scrollTo(0, 0);
                
                // If navigating to templates, render them
                if(pageId === 'templates') this.renderTemplatesPage();
                
                // If navigating to final preview, render the CV there
                if(pageId === 'final') {
                    // Slight delay to ensure DOM is ready
                    setTimeout(() => this.builder.renderCV('cv-final-render'), 50);
                    setTimeout(() => window.dispatchEvent(new Event('resize')), 100);
                }

                // If navigating to builder, render the side preview
                if(pageId === 'builder') {
                    setTimeout(() => this.builder.updatePreview(), 50);
                }
                
                if(typeof lucide !== 'undefined') setTimeout(() => lucide.createIcons(), 100);
            }
        },

        toggleMenu: function() {
            const menu = document.getElementById('mobile-menu');
            if(menu) menu.classList.toggle('hidden');
        },

        // --- Admin Functions ---
        admin: {
            // ... existing admin functions ...
        },

        // --- Templates ---
        templates: [
            { id: 'classic', name: 'الاحترافي (ATS)', desc: 'الأفضل للشركات الحكومية والكبرى. متوافق 100%.', img: 'https://placehold.co/300x400/fff/000?text=Imperial+ATS', premium: true, price: '29 ر.س' },
            { id: 'modern', name: 'أونيكس (Corporate)', desc: 'تصميم جانبي أنيق للقطاع الخاص.', img: 'https://placehold.co/300x400/1e293b/fff?text=Onyx+Pro', premium: true, price: '29 ر.س' },
            // ... other templates
        ],

        renderTemplatesPage: function() {
            const grid = document.getElementById('templates-grid');
            if(grid) {
                grid.innerHTML = this.templates.map(t => `
                    <div class="break-inside-avoid mb-8 bg-white/5 border border-white/10 rounded-2xl overflow-hidden hover:border-primary/50 transition-all cursor-pointer group relative" onclick="app.builder.selectTemplate('${t.id}')">
                        ${t.premium ? '<div class="absolute top-4 left-4 z-10 bg-gold text-black text-xs font-bold px-3 py-1 rounded-full flex items-center gap-1 shadow-lg"><i data-lucide="crown" class="w-3 h-3"></i> Premium</div>' : ''}
                        <div class="h-64 bg-gray-800 relative overflow-hidden">
                            <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-2">
                                <span class="text-white font-bold text-lg">${t.name}</span>
                                <span class="bg-primary text-white px-6 py-2 rounded-full font-bold shadow-lg transform scale-90 group-hover:scale-100 transition-transform">استخدم القالب</span>
                            </div>
                            <img src="${t.img}" class="w-full h-full object-cover opacity-80 group-hover:opacity-40 transition-all" />
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold text-white">${t.name}</h3>
                            <p class="text-gray-400 text-sm leading-relaxed">${t.desc}</p>
                        </div>
                    </div>
                `).join('');
                if(typeof lucide !== 'undefined') lucide.createIcons();
            }
        },
        
        ai: {
            lang: 'ar',
            setLang: function(l) { this.lang = l; /* Toggle UI classes */ },

            generate: async function() {
                const rawText = document.getElementById('ai-blob-input').value;
                if(!rawText || rawText.length < 10) return alert('يرجى كتابة بياناتك');

                const loadingModal = document.getElementById('ai-loading');
                loadingModal.classList.remove('hidden');
                
                try {
                    let generatedData;
                    if (typeof process !== 'undefined' && process.env && process.env.API_KEY) {
                        const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                        const prompt = `Act as strict data extractor. Extract valid JSON from: "${rawText}". Output only JSON. Structure: {name, title, email, phone, summary, exp:{role, comp, date, desc}, edu:{deg, uni, year}, skills}. Language: ${this.lang==='ar'?'Arabic':'English'}.`;
                        const response = await ai.models.generateContent({ model: 'gemini-2.5-flash', contents: prompt });
                        generatedData = JSON.parse(response.text.replace(/```json|```/g, '').trim());
                    } else {
                        await new Promise(r => setTimeout(r, 2000));
                        generatedData = this.getMockData(rawText);
                    }
                    this.finalizeGeneration(generatedData);
                } catch (error) {
                    console.error("Error", error);
                    this.finalizeGeneration(this.getMockData(rawText));
                }
            },

            getMockData: function(text) { return { name: "محمد العتيبي", title: "مهندس برمجيات", email: "m@example.com", phone: "0555555555", summary: "خبير...", exp: {role:"Dev", comp:"STC", date:"2022", desc:"..."}, edu: {deg:"CS", uni:"KSU", year:"2020"}, skills: "Java, Python" }; },

            finalizeGeneration: function(data) {
                app.state.data = data;
                app.state.lang = this.lang;
                
                // Populate Builder Inputs just in case they want to edit later
                const safeVal = (id, val) => { const el = document.getElementById(id); if(el) el.value = val || ''; };
                safeVal('inp-name', data.name);
                safeVal('inp-title', data.title);
                safeVal('inp-email', data.email);
                safeVal('inp-phone', data.phone);
                safeVal('inp-summary', data.summary);
                safeVal('inp-exp-role', data.exp?.role);
                safeVal('inp-exp-comp', data.exp?.comp);
                safeVal('inp-exp-date', data.exp?.date);
                safeVal('inp-exp-desc', data.exp?.desc);
                safeVal('inp-edu-deg', data.edu?.deg);
                safeVal('inp-edu-uni', data.edu?.uni);
                safeVal('inp-edu-year', data.edu?.year);
                safeVal('inp-skills', data.skills);

                app.builder.setLanguage(this.lang);
                document.getElementById('ai-loading').classList.add('hidden');
                
                // CRITICAL: Skip builder, go straight to Final View
                app.navigate('final');
            }
        },

        builder: {
            step: 0,
            selectTemplate: function(id) {
                app.state.template = id;
                app.navigate('builder'); // Manual flow starts in builder
            },

            setStep: function(n) {
                this.step = n;
                document.querySelectorAll('.step-btn').forEach((btn, idx) => {
                    btn.classList.toggle('bg-primary', idx === n);
                    btn.classList.toggle('text-white', idx === n);
                    btn.classList.toggle('text-gray-400', idx !== n);
                });
                document.querySelectorAll('.step-content').forEach((el, idx) => {
                    el.classList.toggle('hidden', idx !== n);
                });
            },

            setLanguage: function(lang) {
                app.state.lang = lang;
                document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            },
            
            togglePreview: function() {
               // Mobile toggle logic...
            },

            // Updates the preview based on current DOM inputs (Builder View)
            updatePreview: function() {
                const getValue = (id) => document.getElementById(id) ? document.getElementById(id).value : '';
                app.state.data = {
                    name: getValue('inp-name'), title: getValue('inp-title'), email: getValue('inp-email'), phone: getValue('inp-phone'),
                    summary: getValue('inp-summary'),
                    exp: { role: getValue('inp-exp-role'), comp: getValue('inp-exp-comp'), date: getValue('inp-exp-date'), desc: getValue('inp-exp-desc') },
                    edu: { deg: getValue('inp-edu-deg'), uni: getValue('inp-edu-uni'), year: getValue('inp-edu-year') },
                    skills: getValue('inp-skills')
                };
                this.renderCV('cv-preview');
            },

            // Generic Render Function used by both Builder (preview) and Final View
            renderCV: function(containerId) {
                try {
                    const container = document.getElementById(containerId);
                    if (!container) return;

                    const { data, lang, template } = app.state;
                    const isAr = lang === 'ar';
                    const dir = isAr ? 'rtl' : 'ltr';
                    
                    const L = {
                        summary: isAr ? 'الملخص المهني' : 'Professional Summary',
                        exp: isAr ? 'الخبرات العملية' : 'Work Experience',
                        edu: isAr ? 'التعليم' : 'Education',
                        skills: isAr ? 'المهارات' : 'Skills',
                        contact: isAr ? 'معلومات التواصل' : 'Contact Info'
                    };

                    let html = '';
                    
                    // --- IMPERIAL ATS TEMPLATE (Default) ---
                    // This is the clean, un-messed-up template
                    html = `
                        <div class="h-full bg-white text-gray-900 p-12 ${isAr ? 'font-sans' : 'font-serif'}" dir="${dir}" style="line-height: 1.6;">
                            <header class="border-b-2 border-gray-800 pb-6 mb-8 text-center">
                                <h1 class="text-4xl font-bold uppercase tracking-wide mb-2 text-gray-900">${data.name || (isAr?'الاسم':'Your Name')}</h1>
                                <p class="text-xl font-medium mb-4 text-gray-600 tracking-wide">${data.title || (isAr?'المسمى':'Job Title')}</p>
                                <div class="flex justify-center flex-wrap gap-4 text-sm font-medium text-gray-600" dir="ltr">
                                    <span>${data.email}</span> 
                                    ${data.email && data.phone ? '<span class="text-gray-300">|</span>' : ''} 
                                    <span>${data.phone}</span>
                                </div>
                            </header>
                            <section class="mb-8">
                                <h3 class="font-bold text-lg uppercase border-b border-gray-300 mb-3 pb-1 tracking-wider text-gray-900">${L.summary}</h3>
                                <p class="text-base leading-relaxed text-justify text-gray-800 font-normal">${data.summary}</p>
                            </section>
                            <section class="mb-8">
                                <h3 class="font-bold text-lg uppercase border-b border-gray-300 mb-4 pb-1 tracking-wider text-gray-900">${L.exp}</h3>
                                <div class="mb-5">
                                    <div class="flex justify-between items-baseline mb-1">
                                        <h4 class="font-bold text-lg text-gray-900">${data.exp.role}</h4>
                                        <span class="text-sm font-bold text-gray-700 bg-gray-100 px-3 py-1 rounded">${data.exp.date}</span>
                                    </div>
                                    <div class="text-base font-bold text-gray-600 mb-2 uppercase tracking-wide">${data.exp.comp}</div>
                                    <p class="text-sm text-gray-800 leading-relaxed whitespace-pre-line pl-2 border-l-2 border-gray-200">${data.exp.desc}</p>
                                </div>
                            </section>
                            <section class="mb-8">
                                <h3 class="font-bold text-lg uppercase border-b border-gray-300 mb-4 pb-1 tracking-wider text-gray-900">${L.edu}</h3>
                                <div class="flex justify-between items-baseline">
                                    <div>
                                        <span class="font-bold text-lg block text-gray-900">${data.edu.deg}</span>
                                        <span class="text-base text-gray-700">${data.edu.uni}</span>
                                    </div>
                                    <span class="text-sm font-bold text-gray-700">${data.edu.year}</span>
                                </div>
                            </section>
                            <section>
                                <h3 class="font-bold text-lg uppercase border-b border-gray-300 mb-3 pb-1 tracking-wider text-gray-900">${L.skills}</h3>
                                <div class="flex flex-wrap gap-2 text-sm text-gray-800 leading-7">
                                    ${data.skills.split(',').map(s=> s.trim() ? `<span class="bg-gray-100 px-3 py-1 rounded border border-gray-200 font-medium">${s.trim()}</span>` : '').join('')}
                                </div>
                            </section>
                        </div>`;

                    container.innerHTML = html;
                    if(typeof lucide !== 'undefined') lucide.createIcons();

                } catch (e) {
                    console.error("Rendering error", e);
                }
            }
        },

        auth: {
            mockLogin: function(role) {
                app.state.currentUser = role;
                app.navigate(role === 'admin' ? 'admin' : 'dashboard');
            }
        }
      };

      window.onload = function() {
          try {
              if(typeof lucide !== 'undefined') lucide.createIcons();
              app.navigate('home');
              app.builder.setStep(0);
              
              // Dynamic Scaling for Final View
              function resizeFinalCV() {
                  const wrapper = document.getElementById('cv-final-wrapper');
                  if (!wrapper || wrapper.offsetParent === null) return;
                  
                  const a4Width = 794; 
                  const screenWidth = window.innerWidth;
                  const targetWidth = screenWidth < 850 ? screenWidth - 40 : 794;
                  let scale = targetWidth / a4Width;
                  
                  if (scale > 1.2) scale = 1.2;
                  
                  wrapper.style.transform = `scale(${scale})`;
                  const scaledHeight = 1123 * scale;
                  wrapper.style.height = `${scaledHeight}px`;
                  wrapper.style.width = `${a4Width}px`; 
              }

              window.addEventListener('resize', resizeFinalCV);
              setInterval(resizeFinalCV, 1000); 
              
          } catch(e) { console.error("App init failed", e); }
      };
    </script>
  </body>
</html>